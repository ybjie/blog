---
layout:     post
title:      "RemoteSSH-ConnectIntranetServer"
date:       2016-12-20 17:58:04
author:     "ybjie"
header-img: "img/post-bg-2015.jpg"
tags: 
- 技术
- 捣鼓
- 折腾 
---

昨天为了处理移动硬盘的东西，很不情愿的来了实验室，结果东西实在太大，三者之间double copy很是浪费时间，昨天在实验室一个下午加上一个晚上最后回去的时候数据还是没有完全拷回来，没办法今天又来了一趟实验室...


主要是两个东西，其一是移动硬盘在mac下的分区以及配合TimeMachine进行备份，以及必要时在win机器之间进行一定数据量的拷贝传输，网上搜了一堆文章，看的很是晕头转向，最后发现其实就是那么回事儿，写的太玄乎了，于是，我在这里把我的经验记录一下。其二是可能就要进行试验了，我的mac不可能不停歇的在那里跑数据，实验室的电脑是闲置的，于是考虑把实验室电脑作为server，折腾了大半天，踩了许多坑，最后看起来应该是搞定了，也把我的经验记录下，好了，下面开始正文。


一，移动硬盘的分区以及文件系统的选择


1.希捷1T的机械硬盘，原来在win下使用，现在主力机是mac，而且硬盘主要是我用来收藏电影和保存手机里放不下的照片，此前一直的策略是需要写入的时候打开虚拟机，然后把文件拷过去，当然动作越频繁你就会越感到烦恼。。。

2.硬盘此前被宿舍同学用了一次，但是不知道他怎么搞得，他建的那个文件夹在我的电脑上（mac和win都是）死活无法删除，我尝试了无数种方法，mac和win的命令行也都尝试过，一直没有成功，于是我就越来越郁闷，你越是不让我搞我越是非要搞，刚好我也受不了每次写文件都要开虚拟机，于是决定一次搞彻底

3.mac自带磁盘工具可以抹除硬盘数据，并重新格式化分区以及选择文件系统

4.mac的文件系统，hfs+(Journaled  unJournaled)对应于mac文件系统扩展格式和扩展格式（带日志）

5.由于pc和mac双方阵营的壁垒，导致双方的文件系统不是很兼容。win下最好的当然是ntfs(安全支持大文件，fat32不支持单个大于4g的文件)，同时在ubuntu最近的版本中是可以写的，mac最好的当然是hfs+，毕竟是亲儿子么，但是ntfs在mac下不可以写，只能选择装插件（我表示很不情愿），hfs+在win下不能识别，也只能装插件，不过毕竟现在mac是主力机么，而且考虑到要配合TimeMachine进行备份，于是就...

6.700G主力(hfs+,Journaled),100G备用win(ntfs),200G备份(TimeMachine,hfs+，Journaled)

7.网上说，hfs+(unJournaled)在ubuntu下安装插件是可以写的，我实验的时候比较悲剧，重新挂载之后直接找不到了，吓死我了，本来就对mount命令比较恐惧，于是我放弃了，一点点来回拷贝吧（所以才花了那么长时间）

8.hfs+的日志是可以随意开关的，不会影响数据

> diskutil enableJournal \| disableJournal disk0s2(具体位置)
> diskutil list查看

9.重点看8，5，4


二，远程ssh

1.这个其实并没有具体的计划，只是忽然想起来，刚好闲着于是就动手了，谁知道竟然花了这么久

2.server需要安装openssh_server的，一个命令,之后开启server服务

> sudo /etc/init.d/ssh start
> service ssh start (choose one)
> ps -e \| grep ssh (check)

server配置文件在这里 

> /etc/ssh/sshd_config

若果修改了配置文件需要重启(stop,start)
下面就可以ssh user@host进行访问了

3.但是就在我高兴的时候，忽然想到了一个问题，现在我和机器处于一个局域网，一旦我回宿舍呢？毕竟我不想天天来实验室，于是切换到JLU.PC,再访问果然悲剧

4.于是开始在网上搜索，刚开始还挺高兴，大家遇到的问题挺相似的，后来才发现，我的情况跟他们其实是不一样的,毕竟我和路由器还是在同一个局域网的（最后我又想想其实也差不多，不过这个时候时间已经过去很多了，手动悲剧），网上很多关于花生壳啊什么之类的第三方软件，可是我很不愿意使用它们，于是琢磨啊琢磨，期间看了n篇文章

5.最后有一个方法，看起来可行性很高，在路由器上做一个端口转发，于是需要登录路由器，好吧，先查一下路由器信息
> route 命令搞定
拿到地址后登录路由器，在应用程序-虚拟服务器  进行设置

|   常用服务器  |    外部端口   |      内部端口       |     IP地址    |    协议类型    |
| ------------- |:-------------:| -------------------:| -------------:| --------------:|
|    不选       |  暴露出去的   |  内部主机的服务端口 |     内网IP    |        ALL     |

所谓暴露出去的，就是你想让外部来访问的时候通过哪个端口进行访问，内部端口就是你当前服务开放的是哪个端口，IP当然就是你的机器的内网IP了，协议ALL
好了，ssh成功

6.当然还有很多其他的傻瓜式方法，比如花生壳，还有很多通过二者可以共同连接到的第三个主机进行通信，也还可以使用ssh的反向隧道，不过那个看着太麻烦，放弃


本次行动充分发挥了工科男，不怕死，不作死就不会死，动手搞死你的精神，党和国家会铭记你所做的一切的！
